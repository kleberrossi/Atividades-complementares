{% extends "base.html" %}
{% block title %}Requisições (Admin){% endblock %}
{% block content %}
<h1 class="main-title">Requisições</h1>

<form method="get" style="margin-bottom:12px; display:flex; gap:8px; align-items:center;">
  <label>
    <span class="help">Filtrar por status</span>
    <select class="input" name="status" onchange="this.form.submit()">
      {% set st = status_atual or 'Todas' %}
      {% for opt in ['Todas','Pendente','Deferida','Deferida Parcialmente','Indeferida'] %}
      <option value="{{ opt }}" {% if st==opt %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
  </label>
</form>

<table class="table">
  <thead>
    <tr>
      <th>#</th><th>Aluno</th><th>Turma</th><th>Atividade</th><th>Evento</th><th>Horas Sol.</th><th>Status</th><th>Ações</th>
    </tr>
  </thead>
  <tbody>
  {% for r in requisicoes %}
    <tr>
      <td>{{ r.id }}</td>
      <td>{{ r.AlunoNome or '-' }}</td>
      <td>{{ r.TurmaNumero or '-' }}</td>
      <td>{{ r.AtividadeNome }}</td>
      <td>{{ r.data_evento }}</td>
      <td>{{ r.horas_solicitadas }}</td>
      <td>{{ r.status }}</td>
      <td style="display:flex; gap:8px;">
        <a class="btn" href="{{ url_for('admin_detalhes_requisicao', req_id=r.id) }}">Detalhes</a>
        <a class="btn" href="{{ url_for('admin_processar_requisicao', req_id=r.id) }}">Processar</a>
      </td>
    </tr>
  {% else %}
    <tr><td colspan="8">Nenhuma requisição encontrada.</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
